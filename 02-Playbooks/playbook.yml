- name: TP - Manipulation de fichiers simples
  hosts: localhost
  connection: local
  become: false
  vars:
    target_path: /tmp/sample_copie.txt
    user_owner: "{{ lookup('env','USER') }}"
  tasks:
    - name: Copier un fichier dans /tmp
      ansible.builtin.copy:
        src: fichiers/sample.txt
        dest: "{{ target_path }}"
        owner: "{{ user_owner }}"
        group: "{{ user_owner }}"
        mode: '0644'

    - name: Ajouter une ligne à la fin du fichier copié
      ansible.builtin.lineinfile:
        path: "{{ target_path }}"
        line: "# Ligne ajoutée par Ansible"
        create: true
        owner: "{{ user_owner }}"
        group: "{{ user_owner }}"
        mode: '0644'

    - name: Lire le contenu du fichier copié
      ansible.builtin.slurp:
        src: "{{ target_path }}"
      register: file_content

    - name: Afficher le contenu du fichier
      ansible.builtin.debug:
        msg: "{{ file_content.content | b64decode }}"
        